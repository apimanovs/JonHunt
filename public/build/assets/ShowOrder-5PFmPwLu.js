import{Q as q,p as _,z as L,l as P,o,c as E,w as K,C as X,D as g,a as Y,b as e,t as i,u as s,d as r,h as d,f as h,F as V,g as C,j as S,k as D,r as z,n as W,B as A}from"./app--gSEcGom.js";import{_ as G}from"./AuthenticatedLayout-3_nkEi-e.js";import"./ApplicationLogo-G7dBEAp6.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const Q=e("meta",{name:"csrf-token",content:"{{ csrf_token() }}"},null,-1),J={class:"max-w-7xl mx-auto px-4 py-6"},Z={class:"flex flex-col lg:flex-row gap-6"},ee={class:"w-full lg:w-2/3 bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6"},te={class:"text-3xl font-bold mb-4 text-gray-800 dark:text-gray-100"},se={class:"mb-6"},oe={class:"text-lg text-gray-800 dark:text-gray-300"},re=["href"],ae={key:0,class:"text-lg text-gray-800 dark:text-gray-300"},le=e("strong",null,"Client:",-1),ne=["href"],ie={key:1,class:"text-lg text-gray-800 dark:text-gray-300"},de=e("strong",null,"Freelancer:",-1),ce=["href"],ue={class:"mb-6"},_e={key:0,class:"text-2xl font-semibold mb-2 text-gray-800 dark:text-gray-100"},he={key:1,class:"p-4 border rounded-lg"},me={key:0,class:"text-gray-700 dark:text-gray-300"},pe={class:"font-semibold"},ge={key:1,class:"text-gray-700 dark:text-gray-300"},xe={class:"font-semibold"},be={key:2,class:"text-green-600 font-semibold"},ye=e("p",{class:"text-red-600 font-semibold"}," This order was cancelled. ",-1),fe={key:0,class:"text-gray-700 dark:text-gray-300 mt-1"},ve=e("strong",null,"Reason:",-1),ke={key:0},we={key:0,class:"mt-6"},Ce=e("h3",{class:"text-2xl font-semibold mb-2 text-gray-800 dark:text-gray-100"}," Submitted Work ",-1),Se={class:"mb-2 text-gray-800 dark:text-gray-300"},De=e("strong",null,"Description:",-1),Fe={class:"mb-4"},Te=["href"],Me=e("button",{type:"submit",class:"px-5 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200 ease-in-out"}," Mark as Complete ",-1),Oe=[Me],Be={key:1},Ie={key:0,class:"mt-6"},Re=e("h3",{class:"text-2xl font-semibold mb-2 text-gray-800 dark:text-gray-100"}," Submit Your Work ",-1),Ve=e("button",{type:"submit",class:"bg-green-500 text-white px-5 py-2 rounded-lg hover:bg-green-600 transition duration-200 ease-in-out"}," Submit Work ",-1),We={key:1,class:"mt-6"},je=e("h3",{class:"text-2xl font-semibold mb-2 text-gray-800 dark:text-gray-100"}," Your Submitted Work ",-1),He={class:"mb-2 text-gray-800 dark:text-gray-300"},Ne=e("strong",null,"Description:",-1),$e=["href"],Ue={key:2,class:"mt-6"},qe={key:0,class:"mt-4"},Le=e("button",{type:"submit",class:"w-full px-5 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200 ease-in-out"}," Confirm Cancellation ",-1),Pe={key:2},Ee=e("p",{class:"text-gray-700"},"You do not have permission to view this order.",-1),Ke=[Ee],Xe={class:"lg:w-1/3 bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 flex flex-col"},Ye=e("h3",{class:"text-2xl font-bold mb-4"},"Chat",-1),ze={class:"flex items-start"},Ae={class:"flex items-center"},Ge={class:"font-semibold mr-2"},Qe={class:"text-xs text-gray-500"},Je={class:"mt-4 flex"},rt={__name:"ShowOrder",setup(Ze){const{props:F}=q(),t=F.order,c=F.auth||{user:null},f=_(""),v=_(null),k=_(!1),x=_(""),b=_(null),m=_(""),p=_([]);t.id;const j=a=>{v.value=a.target.files[0]},T=()=>{X(()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)})},H=async()=>{const a=await g.get(route("orders.messages",t.id));p.value=a.data,console.log(p.value),T()},M=async()=>{if(m.value.trim()==="")return;const a=c.user.id===t.client_id?t.freelancer_id:t.client_id;await g.post(route("messages.store"),{order_id:t.id,Content:m.value,ReceiverID:a}),m.value=""};L(()=>{H();const l=new Pusher("GoofNBCH",{wsHost:window.location.hostname,wsPort:6001,cluster:"mt1",forceTLS:!1,disableStats:!0,authEndpoint:"/broadcasting/auth",auth:{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"X-Requested-With":"XMLHttpRequest"}}}).subscribe(`private-order.${t.id}`);l.bind("message.sent",u=>{p.value.some(y=>y.MessageID===u.message.MessageID)||(p.value.push({...u.message,sender:u.message.sender??{name:"Unknown"}}),T())}),l.bind("pusher:subscription_succeeded",()=>{console.log("Subscribed to private-order channel successfully")}),l.bind("pusher:subscription_error",u=>{console.error("Subscription error:",u)})});const N=async()=>{const a=new FormData;a.append("result_text",f.value),v.value&&a.append("result_file",v.value);try{await g.post(route("orders.submit-work",t.id),a),alert("Work submitted successfully!"),location.reload()}catch(l){console.error(l),alert("Failed to submit work.")}},$=async()=>{try{await g.post(route("orders.complete",t.id)),alert("Order completed!"),location.reload()}catch(a){console.error(a),alert("Failed to complete order.")}},U=async()=>{if(!x.value.trim()){alert("Please provide a reason for cancellation.");return}try{await g.post(route("orders.updateStatus",t.id),{status:"cancelled",cancel_reason:x.value}),alert("Order has been cancelled."),location.reload()}catch(a){console.error(a),alert("Failed to cancel order.")}};return(a,l)=>{const u=P("Head");return o(),E(G,null,{default:K(()=>{var w,y,O,B,I,R;return[Y(u,{title:"Order Details"}),Q,e("div",J,[e("div",Z,[e("div",ee,[e("h2",te," Order #"+i(s(t).id),1),e("div",se,[e("p",oe,[e("a",{href:`/gigs/${s(t).job_application.job_ad.id}`,class:"ml-2 text-2xl text-gray-600 hover:text-red-600"},i(s(t).job_application.job_ad.Title),9,re)]),((w=s(c).user)==null?void 0:w.id)===s(t).freelancer.id?(o(),r("p",ae,[le,e("a",{href:`/profile/${s(t).client.username}`,class:"ml-2 text-gray-600 hover:text-red-600"},i(s(t).client.name),9,ne)])):d("",!0),((y=s(c).user)==null?void 0:y.id)===s(t).client_id?(o(),r("p",ie,[de,e("a",{href:`/profile/${s(t).freelancer.username}`,class:"ml-2 text-gray-600 hover:text-red-600"},i(s(t).freelancer.name),9,ce)])):d("",!0)]),e("div",ue,[((O=s(c).user)==null?void 0:O.id)===s(t).client_id?(o(),r("h3",_e," Status ")):d("",!0),((B=s(c).user)==null?void 0:B.id)===s(t).client_id?(o(),r("div",he,[s(t).status==="in_progress"?(o(),r("p",me,[h(" Freelancer "),e("span",pe,i(s(t).freelancer.name),1),h(" is currently working on your project. ")])):s(t).status==="submitted"?(o(),r("p",ge,[h(" Freelancer "),e("span",xe,i(s(t).freelancer.name),1),h(" has submitted the work. Please review below. ")])):s(t).status==="completed"?(o(),r("p",be," This order is completed. ")):s(t).status==="cancelled"?(o(),r(V,{key:3},[ye,s(t).cancel_reason?(o(),r("p",fe,[ve,h(" "+i(s(t).cancel_reason),1)])):d("",!0)],64)):d("",!0)])):d("",!0)]),e("div",null,[((I=s(c).user)==null?void 0:I.id)===s(t).client_id?(o(),r("div",ke,[s(t).status==="submitted"?(o(),r("div",we,[Ce,e("p",Se,[De,h(" "+i(s(t).result_text),1)]),e("div",Fe,[s(t).result_file?(o(),r("a",{key:0,href:s(t).result_file,target:"_blank",class:"text-blue-600 hover:underline font-medium"}," Download Attached File ",8,Te)):d("",!0)]),e("form",{onSubmit:C($,["prevent"])},Oe,32)])):d("",!0)])):((R=s(c).user)==null?void 0:R.id)===s(t).freelancer_id?(o(),r("div",Be,[s(t).status==="in_progress"?(o(),r("div",Ie,[Re,e("form",{onSubmit:C(N,["prevent"]),class:"space-y-4"},[S(e("textarea",{"onUpdate:modelValue":l[0]||(l[0]=n=>f.value=n),placeholder:"Describe your work...",class:"w-full p-3 border rounded-lg text-gray-800 dark:text-gray-300",required:""},null,512),[[D,f.value]]),e("input",{type:"file",onChange:j,class:"block"},null,32),Ve],32)])):s(t).status==="submitted"?(o(),r("div",We,[je,e("p",He,[Ne,h(" "+i(s(t).result_text),1)]),e("div",null,[s(t).result_file?(o(),r("a",{key:0,href:s(t).result_file,target:"_blank",class:"text-blue-600 hover:underline font-medium"}," Download Attached File ",8,$e)):d("",!0)])])):d("",!0),s(t).status!=="completed"&&s(t).status!=="cancelled"?(o(),r("div",Ue,[e("button",{onClick:l[1]||(l[1]=n=>k.value=!k.value),class:"px-5 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition duration-200 ease-in-out"}," Cancel Order "),k.value?(o(),r("div",qe,[e("form",{onSubmit:C(U,["prevent"]),class:"space-y-3"},[S(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=n=>x.value=n),placeholder:"Reason for cancellation...",class:"w-full p-3 border rounded-lg text-gray-800 dark:text-gray-300",rows:"3"},null,512),[[D,x.value]]),Le],32)])):d("",!0)])):d("",!0)])):(o(),r("div",Pe,Ke))])]),e("div",Xe,[Ye,e("div",{ref_key:"chatContainer",ref:b,class:"flex-1 max-h-[400px] overflow-y-auto border rounded-lg p-4 bg-gray-100"},[(o(!0),r(V,null,z(p.value,n=>(o(),r("div",{key:n.MessageID,class:W(["chat",n.SenderID===s(c).user.id?"chat-end":"chat-start"])},[e("div",ze,[e("div",null,[e("div",Ae,[e("span",Ge,i(n.sender.name),1),e("time",Qe,i(new Date(n.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),1)]),e("div",{class:W(["mt-1 p-3 rounded-lg",n.SenderID===s(c).user.id?"bg-blue-500 text-white self-end":"bg-gray-200 text-black"])},i(n.Content),3)])])],2))),128))],512),e("div",Je,[S(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=n=>m.value=n),placeholder:"Type your message...",class:"flex-1 p-3 border rounded-lg",onKeyup:A(M,["enter"])},null,544),[[D,m.value]]),e("button",{onClick:M,class:"ml-2 px-5 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"}," Send ")])])])])]}),_:1})}}};export{rt as default};
